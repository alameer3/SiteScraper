{% extends "layouts/base.html" %}

{% block title %}Ø£Ø¯Ø§Ø© Ù†Ø³Ø® Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <!-- Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card bg-gradient-dark text-white border-0 shadow-lg">
                <div class="card-body p-4">
                    <div class="d-flex align-items-center justify-content-between">
                        <div>
                            <h1 class="h2 mb-2">ğŸŒ Ø£Ø¯Ø§Ø© Ù†Ø³Ø® Ø§Ù„Ù…ÙˆØ§Ù‚Ø¹ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h1>
                            <p class="mb-0 opacity-8">Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø´Ø§Ù…Ù„ Ù„Ù„Ù…ÙˆØ§Ù‚Ø¹ Ù…Ø¹ ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ ÙˆØªÙ‚Ø§Ø±ÙŠØ± Ù…ÙØµÙ„Ø©</p>
                        </div>
                        <div class="text-end">
                            <div class="d-flex gap-2">
                                <a href="/website-cloner/integrated" class="btn btn-info btn-sm">
                                    <i data-feather="layers"></i> Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„Ø©
                                </a>
                                <a href="/website-cloner/comparison" class="btn btn-warning btn-sm">
                                    <i data-feather="bar-chart-2"></i> Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Øª
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="row">
        <!-- Configuration Panel -->
        <div class="col-lg-4 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i data-feather="settings"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</h5>
                </div>
                <div class="card-body">
                    <form id="clonerForm">
                        <!-- URL Input -->
                        <div class="mb-3">
                            <label for="targetUrl" class="form-label">Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯Ù</label>
                            <input type="url" class="form-control" id="targetUrl" name="target_url" 
                                   placeholder="https://example.com" required>
                            <div class="form-text">Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø±Ø§Ø¯ Ù†Ø³Ø®Ù‡</div>
                        </div>

                        <!-- Extraction Mode -->
                        <div class="mb-3">
                            <label for="primaryTool" class="form-label">Ù†ÙˆØ¹ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</label>
                            <select class="form-select" id="primaryTool" name="primary_tool">
                                <option value="website_cloner_pro">Website Cloner Pro (Ø§Ù„Ø£Ø­Ø¯Ø«)</option>
                                <option value="hybrid">Ù†Ø¸Ø§Ù… Ù‡Ø¬ÙŠÙ† (Website Cloner + Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©)</option>
                                <option value="unified_master">Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙÙ‚Ø·</option>
                            </select>
                        </div>

                        <!-- Advanced Settings -->
                        <div class="mb-3">
                            <label for="maxDepth" class="form-label">Ø¹Ù…Ù‚ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</label>
                            <select class="form-select" id="maxDepth" name="max_depth">
                                <option value="1">Ø³Ø·Ø­ÙŠ (ØµÙØ­Ø© ÙˆØ§Ø­Ø¯Ø©)</option>
                                <option value="2">Ù…ØªÙˆØ³Ø· (Ù…Ø³ØªÙˆÙŠØ§Ù†)</option>
                                <option value="3" selected>Ø¹Ù…ÙŠÙ‚ (3 Ù…Ø³ØªÙˆÙŠØ§Øª)</option>
                                <option value="4">Ø´Ø§Ù…Ù„ (4 Ù…Ø³ØªÙˆÙŠØ§Øª)</option>
                                <option value="5">ÙƒØ§Ù…Ù„ (5 Ù…Ø³ØªÙˆÙŠØ§Øª)</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="maxPages" class="form-label">Ø¹Ø¯Ø¯ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù‚ØµÙˆÙ‰</label>
                            <input type="number" class="form-control" id="maxPages" name="max_pages" 
                                   value="50" min="1" max="500">
                        </div>

                        <!-- Feature Toggles -->
                        <div class="mb-3">
                            <h6>Ø§Ù„Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="extractAssets" 
                                       name="extract_assets" checked>
                                <label class="form-check-label" for="extractAssets">
                                    ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ØµÙˆÙ„ (ØµÙˆØ±ØŒ CSSØŒ JS)
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="analyzeAI" 
                                       name="analyze_with_ai" checked>
                                <label class="form-check-label" for="analyzeAI">
                                    Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="generateReports" 
                                       name="generate_reports" checked>
                                <label class="form-check-label" for="generateReports">
                                    Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…ÙØµÙ„Ø©
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="useHybrid" 
                                       name="use_hybrid">
                                <label class="form-check-label" for="useHybrid">
                                    Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ØªØ®ØµØµØ© Ø¥Ø¶Ø§ÙÙŠØ§Ù‹
                                </label>
                            </div>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary w-100" id="startExtraction">
                            <i data-feather="play"></i> Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ù†Ø³Ø®
                        </button>
                    </form>
                </div>
            </div>

            <!-- Tool Information -->
            <div class="card shadow-sm border-0 mt-3">
                <div class="card-header bg-info text-white">
                    <h6 class="mb-0"><i data-feather="info"></i> Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø¯ÙˆØ§Øª</h6>
                </div>
                <div class="card-body">
                    <div class="accordion" id="toolsAccordion">
                        <div class="accordion-item">
                            <h2 class="accordion-header">
                                <button class="accordion-button collapsed" type="button" 
                                        data-bs-toggle="collapse" data-bs-target="#clonerInfo">
                                    Website Cloner Pro
                                </button>
                            </h2>
                            <div id="clonerInfo" class="accordion-collapse collapse" 
                                 data-bs-parent="#toolsAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li>âœ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø´Ø§Ù…Ù„ (6 Ù…Ø±Ø§Ø­Ù„)</li>
                                        <li>âœ… ØªØ­Ù„ÙŠÙ„ Ø°ÙƒÙŠ Ø¨Ø§Ù„AI</li>
                                        <li>âœ… ØªÙ‚Ø§Ø±ÙŠØ± Ù…ØªØ¹Ø¯Ø¯Ø© Ø§Ù„ØµÙŠØº</li>
                                        <li>âœ… Ù†Ø³Ø® Ø·Ø¨Ù‚ Ø§Ù„Ø£ØµÙ„</li>
                                        <li>âœ… ØªØ­Ù„ÙŠÙ„ Ø£Ù…Ù†ÙŠ Ù…ØªÙ‚Ø¯Ù…</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="accordion-item">
                            <button class="accordion-button collapsed" type="button" 
                                    data-bs-toggle="collapse" data-bs-target="#hybridInfo">
                                Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¬ÙŠÙ†
                            </button>
                            <div id="hybridInfo" class="accordion-collapse collapse" 
                                 data-bs-parent="#toolsAccordion">
                                <div class="accordion-body">
                                    <ul class="list-unstyled">
                                        <li>ğŸ”„ ÙŠØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø¯ÙˆØ§Øª</li>
                                        <li>ğŸ“Š Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ù†ØªØ§Ø¦Ø¬</li>
                                        <li>ğŸ¯ Ø£ÙØ¶Ù„ Ø¯Ù‚Ø©</li>
                                        <li>âš¡ Ø£Ø·ÙˆÙ„ ÙÙŠ Ø§Ù„ÙˆÙ‚Øª</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Results Panel -->
        <div class="col-lg-8">
            <!-- Status Card -->
            <div class="card shadow-sm border-0 mb-4" id="statusCard" style="display: none;">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i data-feather="activity"></i> Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</h5>
                    <span class="badge bg-info" id="statusBadge">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ±...</span>
                </div>
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span id="statusMessage">Ø¨Ø¯Ø¡ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress mb-3">
                        <div class="progress-bar bg-primary" id="progressBar" style="width: 0%"></div>
                    </div>
                    <div class="row text-center">
                        <div class="col-md-3">
                            <small class="text-muted">Ù…Ø¹Ø±Ù Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</small>
                            <div class="fw-bold" id="extractionId">-</div>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡</small>
                            <div class="fw-bold" id="startTime">-</div>
                        </div>
                        <div class="col-md-3">
                            <small class="text-muted">Ø§Ù„Ù…Ø¯Ø© Ø§Ù„Ù…Ù‚Ø¯Ø±Ø©</small>
                            <div class="fw-bold" id="estimatedTime">-</div>
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-sm btn-outline-danger" id="cancelBtn" style="display: none;">
                                Ø¥Ù„ØºØ§Ø¡
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Card -->
            <div class="card shadow-sm border-0" id="resultsCard" style="display: none;">
                <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i data-feather="check-circle"></i> Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</h5>
                    <div class="dropdown">
                        <button class="btn btn-light btn-sm dropdown-toggle" type="button" 
                                data-bs-toggle="dropdown">
                            ØªØ­Ù…ÙŠÙ„
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" data-download="json">
                                <i data-feather="file-text"></i> Ù…Ù„Ù JSON
                            </a></li>
                            <li><a class="dropdown-item" href="#" data-download="csv">
                                <i data-feather="table"></i> Ù…Ù„Ù CSV
                            </a></li>
                            <li><a class="dropdown-item" href="#" data-download="site">
                                <i data-feather="globe"></i> Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªÙ†Ø³Ø®
                            </a></li>
                        </ul>
                    </div>
                </div>
                <div class="card-body">
                    <!-- Summary Stats -->
                    <div class="row mb-4">
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                <h4 class="text-primary mb-1" id="pagesCount">0</h4>
                                <small class="text-muted">ØµÙØ­Ø§Øª Ù…Ø³ØªØ®Ø±Ø¬Ø©</small>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                <h4 class="text-success mb-1" id="assetsCount">0</h4>
                                <small class="text-muted">Ø£ØµÙˆÙ„ Ù…Ø­Ù…Ù„Ø©</small>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                <h4 class="text-info mb-1" id="techCount">0</h4>
                                <small class="text-muted">ØªÙ‚Ù†ÙŠØ§Øª Ù…ÙƒØªØ´ÙØ©</small>
                            </div>
                        </div>
                        <div class="col-md-3 text-center">
                            <div class="border rounded p-3">
                                <h4 class="text-warning mb-1" id="qualityScore">0</h4>
                                <small class="text-muted">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆØ¯Ø©</small>
                            </div>
                        </div>
                    </div>

                    <!-- Detailed Results Tabs -->
                    <ul class="nav nav-tabs mb-3" id="resultsTabs">
                        <li class="nav-item">
                            <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#summaryTab">
                                Ø§Ù„Ù…Ù„Ø®Øµ
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#comparisonTab">
                                Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#technologiesTab">
                                Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª
                            </button>
                        </li>
                        <li class="nav-item">
                            <button class="nav-link" data-bs-toggle="tab" data-bs-target="#recommendationsTab">
                                Ø§Ù„ØªÙˆØµÙŠØ§Øª
                            </button>
                        </li>
                    </ul>

                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="summaryTab">
                            <div id="summaryContent">
                                <!-- Summary content will be populated here -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="comparisonTab">
                            <div id="comparisonContent">
                                <!-- Comparison content will be populated here -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="technologiesTab">
                            <div id="technologiesContent">
                                <!-- Technologies content will be populated here -->
                            </div>
                        </div>
                        <div class="tab-pane fade" id="recommendationsTab">
                            <div id="recommendationsContent">
                                <!-- Recommendations content will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('clonerForm');
    const statusCard = document.getElementById('statusCard');
    const resultsCard = document.getElementById('resultsCard');
    
    let currentExtractionId = null;
    let statusInterval = null;
    
    // Handle form submission
    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        
        // Convert checkboxes to booleans
        data.extract_assets = formData.has('extract_assets');
        data.analyze_with_ai = formData.has('analyze_with_ai');
        data.generate_reports = formData.has('generate_reports');
        data.use_hybrid = formData.has('use_hybrid');
        
        try {
            // Start extraction
            const response = await fetch('/api/website-cloner/extract', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data)
            });
            
            const result = await response.json();
            
            if (result.success) {
                currentExtractionId = result.extraction_id;
                showStatusCard(result);
                startStatusPolling();
            } else {
                alert('Ø®Ø·Ø£: ' + result.error);
            }
        } catch (error) {
            alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ' + error.message);
        }
    });
    
    function showStatusCard(result) {
        statusCard.style.display = 'block';
        resultsCard.style.display = 'none';
        
        document.getElementById('extractionId').textContent = result.extraction_id;
        document.getElementById('startTime').textContent = new Date().toLocaleTimeString('ar');
        document.getElementById('statusBadge').textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ´ØºÙŠÙ„...';
        document.getElementById('statusBadge').className = 'badge bg-warning';
    }
    
    function startStatusPolling() {
        if (statusInterval) clearInterval(statusInterval);
        
        statusInterval = setInterval(async () => {
            if (!currentExtractionId) return;
            
            try {
                const response = await fetch(`/api/website-cloner/status/${currentExtractionId}`);
                const status = await response.json();
                
                if (status.success) {
                    updateStatus(status);
                    
                    if (status.status === 'completed') {
                        clearInterval(statusInterval);
                        await loadResults();
                    } else if (status.status === 'failed') {
                        clearInterval(statusInterval);
                        showError(status.error);
                    }
                }
            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©:', error);
            }
        }, 2000); // Poll every 2 seconds
    }
    
    function updateStatus(status) {
        document.getElementById('statusMessage').textContent = status.message;
        document.getElementById('progressPercent').textContent = status.progress + '%';
        document.getElementById('progressBar').style.width = status.progress + '%';
        
        if (status.progress === 100) {
            document.getElementById('statusBadge').textContent = 'Ù…ÙƒØªÙ…Ù„';
            document.getElementById('statusBadge').className = 'badge bg-success';
        }
    }
    
    async function loadResults() {
        try {
            const response = await fetch(`/api/website-cloner/results/${currentExtractionId}`);
            const results = await response.json();
            
            if (results.success) {
                showResults(results);
            } else {
                showError(results.error);
            }
        } catch (error) {
            showError('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ù†ØªØ§Ø¦Ø¬: ' + error.message);
        }
    }
    
    function showResults(results) {
        resultsCard.style.display = 'block';
        
        // Update summary stats
        const summary = results.website_cloner_summary || {};
        document.getElementById('pagesCount').textContent = summary.pages_extracted || 0;
        document.getElementById('assetsCount').textContent = summary.assets_downloaded || 0;
        document.getElementById('techCount').textContent = (summary.technologies_detected || []).length;
        
        const integratedSummary = results.integrated_summary || {};
        document.getElementById('qualityScore').textContent = integratedSummary.quality_score || 0;
        
        // Populate tabs
        populateSummaryTab(results);
        populateComparisonTab(results);
        populateTechnologiesTab(results);
        populateRecommendationsTab(results);
        
        // Setup download links
        setupDownloadLinks();
    }
    
    function populateSummaryTab(results) {
        const summary = results.website_cloner_summary || {};
        const content = document.getElementById('summaryContent');
        
        content.innerHTML = `
            <div class="row">
                <div class="col-md-6">
                    <h6>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©</h6>
                    <ul class="list-unstyled">
                        <li><strong>Ø§Ù„Ù‡Ø¯Ù:</strong> ${results.summary?.target_url || '-'}</li>
                        <li><strong>Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø©:</strong> ${results.summary?.primary_tool || '-'}</li>
                        <li><strong>Ø§Ù„Ù…Ø¯Ø©:</strong> ${results.summary?.duration ? results.summary.duration.toFixed(2) + ' Ø«Ø§Ù†ÙŠØ©' : '-'}</li>
                        <li><strong>Ø§Ù„Ù†Ø¬Ø§Ø­:</strong> ${summary.success ? 'âœ… Ù†Ø¹Ù…' : 'âŒ Ù„Ø§'}</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h6>Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬</h6>
                    <ul class="list-unstyled">
                        <li><strong>Ø§Ù„ØµÙØ­Ø§Øª:</strong> ${summary.pages_extracted || 0}</li>
                        <li><strong>Ø§Ù„Ø£ØµÙˆÙ„:</strong> ${summary.assets_downloaded || 0}</li>
                        <li><strong>Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong> ${summary.total_size ? (summary.total_size / 1024).toFixed(1) + ' KB' : '-'}</li>
                        <li><strong>Ø§Ù„Ù…Ø¬Ù„Ø¯:</strong> ${summary.output_path || '-'}</li>
                    </ul>
                </div>
            </div>
        `;
    }
    
    function populateComparisonTab(results) {
        const comparison = results.comparison_analysis || {};
        const content = document.getElementById('comparisonContent');
        
        if (Object.keys(comparison).length === 0) {
            content.innerHTML = '<p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ø±Ù†Ø© Ù…ØªØ§Ø­Ø© - Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù‡Ø¬ÙŠÙ†</p>';
            return;
        }
        
        content.innerHTML = `
            <h6>Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ù‚Ø§Ø±Ù†Ø©</h6>
            <div class="alert alert-info">
                <strong>Ø§Ù„ØªÙˆØµÙŠØ©:</strong> ${comparison.recommendation || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}
            </div>
            <div class="row">
                <div class="col-md-6">
                    <h6>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø³Ø±Ø¹Ø©</h6>
                    ${comparison.extraction_speed ? `
                        <ul class="list-unstyled">
                            <li>Website Cloner Pro: ${comparison.extraction_speed.website_cloner_pro}</li>
                            <li>Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${comparison.extraction_speed.unified_extractor}</li>
                            <li><strong>Ø§Ù„Ø£Ø³Ø±Ø¹:</strong> ${comparison.extraction_speed.faster_tool}</li>
                        </ul>
                    ` : '<p class="text-muted">ØºÙŠØ± Ù…ØªÙˆÙØ±</p>'}
                </div>
                <div class="col-md-6">
                    <h6>Ù…Ù‚Ø§Ø±Ù†Ø© Ø§Ù„Ø¬ÙˆØ¯Ø©</h6>
                    ${comparison.content_quality ? `
                        <ul class="list-unstyled">
                            <li>Website Cloner Pro: ${comparison.content_quality.website_cloner_pro_pages} ØµÙØ­Ø©</li>
                            <li>Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©: ${comparison.content_quality.unified_extractor_pages} ØµÙØ­Ø©</li>
                            <li><strong>Ø§Ù„Ø£ÙØ¶Ù„:</strong> ${comparison.content_quality.better_coverage}</li>
                        </ul>
                    ` : '<p class="text-muted">ØºÙŠØ± Ù…ØªÙˆÙØ±</p>'}
                </div>
            </div>
        `;
    }
    
    function populateTechnologiesTab(results) {
        const technologies = results.integrated_summary?.combined_technologies || 
                           results.website_cloner_summary?.technologies_detected || [];
        const content = document.getElementById('technologiesContent');
        
        if (technologies.length === 0) {
            content.innerHTML = '<p class="text-muted">Ù„Ù… ÙŠØªÙ… Ø§ÙƒØªØ´Ø§Ù ØªÙ‚Ù†ÙŠØ§Øª Ù…Ø­Ø¯Ø¯Ø©</p>';
            return;
        }
        
        const techList = technologies.map(tech => `
            <span class="badge bg-primary me-2 mb-2">${tech}</span>
        `).join('');
        
        content.innerHTML = `
            <h6>Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªØ´ÙØ© (${technologies.length})</h6>
            <div class="mb-3">${techList}</div>
            <h6>ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª</h6>
            <div class="row">
                ${technologies.map(tech => `
                    <div class="col-md-4 mb-2">
                        <div class="border rounded p-2 text-center">
                            <small class="text-muted">${tech}</small>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    }
    
    function populateRecommendationsTab(results) {
        const recommendations = results.recommendations || [];
        const content = document.getElementById('recommendationsContent');
        
        if (recommendations.length === 0) {
            content.innerHTML = '<p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ù…ØªØ§Ø­Ø©</p>';
            return;
        }
        
        const recList = recommendations.map((rec, index) => `
            <div class="alert alert-info">
                <strong>${index + 1}.</strong> ${rec}
            </div>
        `).join('');
        
        content.innerHTML = `
            <h6>Ø§Ù„ØªÙˆØµÙŠØ§Øª (${recommendations.length})</h6>
            ${recList}
        `;
    }
    
    function setupDownloadLinks() {
        document.querySelectorAll('[data-download]').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const type = this.dataset.download;
                if (currentExtractionId) {
                    window.open(`/api/website-cloner/download/${currentExtractionId}/${type}`, '_blank');
                }
            });
        });
    }
    
    function showError(error) {
        document.getElementById('statusBadge').textContent = 'ÙØ´Ù„';
        document.getElementById('statusBadge').className = 'badge bg-danger';
        document.getElementById('statusMessage').textContent = 'Ø®Ø·Ø£: ' + error;
    }
});
</script>
{% endblock %}