{% extends "base.html" %}

{% block title %}الإعدادات - {{ super() }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-lg border-0">
                <div class="card-header bg-secondary text-white">
                    <h2 class="mb-0">
                        <i data-feather="settings" class="me-2"></i>
                        إعدادات التطبيق
                    </h2>
                </div>
                <div class="card-body p-4">
                    
                    <!-- General Settings -->
                    <div class="settings-section mb-5">
                        <h4 class="text-primary mb-3">
                            <i data-feather="sliders" class="me-2"></i>
                            الإعدادات العامة
                        </h4>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="max_depth" class="form-label">عمق التحليل الافتراضي</label>
                                <select class="form-select" id="max_depth">
                                    <option value="1">سطحي (1 مستوى)</option>
                                    <option value="2" selected>متوسط (2 مستوى)</option>
                                    <option value="3">عميق (3 مستويات)</option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                <label for="analysis_timeout" class="form-label">مهلة التحليل (ثانية)</label>
                                <input type="number" class="form-control" id="analysis_timeout" value="120" min="30" max="300">
                            </div>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="enable_ad_blocking" checked>
                            <label class="form-check-label" for="enable_ad_blocking">
                                تفعيل حجب الإعلانات افتراضياً
                            </label>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="save_history" checked>
                            <label class="form-check-label" for="save_history">
                                حفظ سجل التحليلات
                            </label>
                        </div>
                    </div>
                    
                    <!-- Analysis Settings -->
                    <div class="settings-section mb-5">
                        <h4 class="text-success mb-3">
                            <i data-feather="activity" class="me-2"></i>
                            إعدادات التحليل
                        </h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <label class="form-label">أنواع التحليل المفعلة</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable_security" checked>
                                    <label class="form-check-label" for="enable_security">تحليل الأمان</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable_performance" checked>
                                    <label class="form-check-label" for="enable_performance">تحليل الأداء</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable_seo" checked>
                                    <label class="form-check-label" for="enable_seo">تحليل SEO</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable_competitor" checked>
                                    <label class="form-check-label" for="enable_competitor">تحليل المنافسين</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable_technical" checked>
                                    <label class="form-check-label" for="enable_technical">التحليل التقني</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="enable_comprehensive" checked>
                                    <label class="form-check-label" for="enable_comprehensive">التحليل الشامل</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Management -->
                    <div class="settings-section mb-5">
                        <h4 class="text-warning mb-3">
                            <i data-feather="database" class="me-2"></i>
                            إدارة البيانات
                        </h4>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <button type="button" class="btn btn-outline-primary w-100 mb-2">
                                    <i data-feather="download" class="me-2"></i>
                                    تصدير جميع البيانات
                                </button>
                            </div>
                            <div class="col-md-6">
                                <button type="button" class="btn btn-outline-danger w-100 mb-2">
                                    <i data-feather="trash-2" class="me-2"></i>
                                    حذف السجل القديم
                                </button>
                            </div>
                        </div>
                        
                        <div class="alert alert-info mt-3">
                            <i data-feather="info" class="me-2"></i>
                            <strong>معلومة:</strong> يتم حفظ البيانات محلياً وليس في السحابة
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div class="text-center">
                        <button type="button" class="btn btn-primary btn-lg me-3" onclick="saveSettings()">
                            <i data-feather="save" class="me-2"></i>
                            حفظ الإعدادات
                        </button>
                        <button type="button" class="btn btn-outline-secondary btn-lg" onclick="resetSettings()">
                            <i data-feather="refresh-cw" class="me-2"></i>
                            إعادة تعيين
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    feather.replace();
    loadSettings();
});

function saveSettings() {
    const settings = {
        max_depth: document.getElementById('max_depth').value,
        analysis_timeout: document.getElementById('analysis_timeout').value,
        enable_ad_blocking: document.getElementById('enable_ad_blocking').checked,
        save_history: document.getElementById('save_history').checked,
        enabled_analyses: {
            security: document.getElementById('enable_security').checked,
            performance: document.getElementById('enable_performance').checked,
            seo: document.getElementById('enable_seo').checked,
            competitor: document.getElementById('enable_competitor').checked,
            technical: document.getElementById('enable_technical').checked,
            comprehensive: document.getElementById('enable_comprehensive').checked
        }
    };
    
    localStorage.setItem('analyzer_settings', JSON.stringify(settings));
    
    // Show success message
    const alert = document.createElement('div');
    alert.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 start-50 translate-middle-x';
    alert.style.zIndex = '9999';
    alert.innerHTML = `
        <i data-feather="check-circle" class="me-2"></i>
        تم حفظ الإعدادات بنجاح
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    document.body.appendChild(alert);
    feather.replace();
    
    setTimeout(() => {
        alert.remove();
    }, 3000);
}

function loadSettings() {
    const saved = localStorage.getItem('analyzer_settings');
    if (saved) {
        const settings = JSON.parse(saved);
        
        document.getElementById('max_depth').value = settings.max_depth || '2';
        document.getElementById('analysis_timeout').value = settings.analysis_timeout || '120';
        document.getElementById('enable_ad_blocking').checked = settings.enable_ad_blocking !== false;
        document.getElementById('save_history').checked = settings.save_history !== false;
        
        if (settings.enabled_analyses) {
            Object.keys(settings.enabled_analyses).forEach(key => {
                const element = document.getElementById(`enable_${key}`);
                if (element) {
                    element.checked = settings.enabled_analyses[key] !== false;
                }
            });
        }
    }
}

function resetSettings() {
    if (confirm('هل أنت متأكد من إعادة تعيين جميع الإعدادات؟')) {
        localStorage.removeItem('analyzer_settings');
        location.reload();
    }
}
</script>
{% endblock %}