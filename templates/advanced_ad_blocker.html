{% extends "base.html" %}

{% block title %}حاجب الإعلانات المتطور{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="glass-card p-4">
                <h1 class="h2 text-primary mb-3">
                    <i data-feather="shield" class="me-2"></i>
                    حاجب الإعلانات المتطور
                </h1>
                <p class="text-muted">
                    حماية ذكية من الإعلانات مع الحفاظ على المحتوى المفيد
                </p>
                
                <div class="alert alert-info border-0 bg-info bg-opacity-10">
                    <div class="d-flex align-items-center">
                        <i data-feather="zap" class="text-info me-2"></i>
                        <strong>تقنية متطورة:</strong> 
                        كشف ذكي للإعلانات، حماية من التتبع، تحسين الأداء
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- نموذج حجب الإعلانات -->
            <div class="glass-card p-4 mb-4">
                <h3 class="h4 mb-3">
                    <i data-feather="settings" class="me-2"></i>
                    إعدادات الحجب المتطور
                </h3>
                
                <form id="adBlockForm">
                    <div class="row g-3">
                        <div class="col-md-8">
                            <label for="targetUrl" class="form-label">رابط الموقع</label>
                            <div class="input-group">
                                <span class="input-group-text bg-primary text-white">
                                    <i data-feather="link" width="16"></i>
                                </span>
                                <input type="url" class="form-control" id="targetUrl" 
                                       placeholder="https://example.com" required>
                            </div>
                        </div>
                        
                        <div class="col-md-4">
                            <label for="blockingLevel" class="form-label">مستوى الحجب</label>
                            <select class="form-select" id="blockingLevel">
                                <option value="light">خفيف - الإعلانات الأساسية</option>
                                <option value="standard" selected>قياسي - حجب شامل</option>
                                <option value="aggressive">قوي - حجب متقدم</option>
                                <option value="expert">خبير - حجب كامل</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- خيارات الحجب -->
                    <div class="mt-4">
                        <h5>أنواع الحجب</h5>
                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="blockGoogleAds" checked>
                                    <label class="form-check-label" for="blockGoogleAds">
                                        إعلانات Google (AdSense, DoubleClick)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="blockSocialTrackers" checked>
                                    <label class="form-check-label" for="blockSocialTrackers">
                                        تتبع وسائل التواصل الاجتماعي
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="blockAnalytics" checked>
                                    <label class="form-check-label" for="blockAnalytics">
                                        أدوات التحليل والتتبع
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="blockVideoAds">
                                    <label class="form-check-label" for="blockVideoAds">
                                        إعلانات الفيديو
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="blockPopups" checked>
                                    <label class="form-check-label" for="blockPopups">
                                        النوافذ المنبثقة
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="blockCryptominers" checked>
                                    <label class="form-check-label" for="blockCryptominers">
                                        منجيو العملات المشفرة
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i data-feather="shield" width="16" class="me-1"></i>
                            تطبيق الحجب المتطور
                        </button>
                    </div>
                </form>
                
                <!-- نتائج الحجب -->
                <div id="blockingResults" class="mt-4" style="display: none;">
                    <div class="card bg-success bg-opacity-10 border-success">
                        <div class="card-body">
                            <h5 class="card-title text-success">
                                <i data-feather="check-circle" class="me-2"></i>
                                تم تطبيق الحجب بنجاح!
                            </h5>
                            <div id="blockingStats">
                                <!-- سيتم ملؤها ديناميكياً -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- الشريط الجانبي -->
        <div class="col-lg-4">
            <!-- إحصائيات الحجب -->
            <div class="glass-card p-4 mb-4">
                <h5 class="h6 mb-3">
                    <i data-feather="pie-chart" class="me-2"></i>
                    إحصائيات مباشرة
                </h5>
                
                <div class="row g-3">
                    <div class="col-6">
                        <div class="text-center">
                            <div class="h4 text-danger" id="blockedAds">0</div>
                            <small class="text-muted">إعلانات محجوبة</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <div class="h4 text-warning" id="blockedTrackers">0</div>
                            <small class="text-muted">متتبعات محجوبة</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <div class="h4 text-info" id="sizeSaved">0 KB</div>
                            <small class="text-muted">حجم محفوظ</small>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="text-center">
                            <div class="h4 text-success" id="speedImprovement">0%</div>
                            <small class="text-muted">تحسن السرعة</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- أنواع الحجب -->
            <div class="glass-card p-4">
                <h5 class="h6 mb-3">
                    <i data-feather="layers" class="me-2"></i>
                    أنواع الحماية
                </h5>
                
                <div class="small text-light">
                    <div class="mb-2">
                        <i data-feather="x-circle" width="14" class="me-1 text-danger"></i>
                        حجب إعلانات Google و Facebook
                    </div>
                    <div class="mb-2">
                        <i data-feather="eye-off" width="14" class="me-1 text-warning"></i>
                        منع التتبع والاستهداف
                    </div>
                    <div class="mb-2">
                        <i data-feather="zap-off" width="14" class="me-1 text-info"></i>
                        حجب منجيو العملات المشفرة
                    </div>
                    <div class="mb-2">
                        <i data-feather="x-square" width="14" class="me-1 text-success"></i>
                        إزالة النوافذ المنبثقة
                    </div>
                    <div>
                        <i data-feather="filter" width="14" class="me-1 text-primary"></i>
                        تنظيف المحتوى التلقائي
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.getElementById('adBlockForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const url = document.getElementById('targetUrl').value;
    const level = document.getElementById('blockingLevel').value;
    
    const blockingOptions = {
        google_ads: document.getElementById('blockGoogleAds').checked,
        social_trackers: document.getElementById('blockSocialTrackers').checked,
        analytics: document.getElementById('blockAnalytics').checked,
        video_ads: document.getElementById('blockVideoAds').checked,
        popups: document.getElementById('blockPopups').checked,
        cryptominers: document.getElementById('blockCryptominers').checked
    };
    
    try {
        const response = await fetch('/api/advanced-ad-block', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                url: url,
                level: level,
                options: blockingOptions
            })
        });
        
        const data = await response.json();
        
        if (data.status === 'success') {
            document.getElementById('blockingResults').style.display = 'block';
            
            // تحديث الإحصائيات
            document.getElementById('blockedAds').textContent = data.result.blocked_ads || 0;
            document.getElementById('blockedTrackers').textContent = data.result.blocked_trackers || 0;
            document.getElementById('sizeSaved').textContent = (data.result.size_saved / 1024).toFixed(1) + ' KB';
            document.getElementById('speedImprovement').textContent = data.result.speed_improvement + '%';
            
            document.getElementById('blockingStats').innerHTML = `
                <p><strong>تم حجب ${data.result.total_blocked} عنصر</strong></p>
                <p>تحسن الأداء: ${data.result.performance_score}%</p>
                <p>وقت المعالجة: ${data.result.processing_time} ثانية</p>
            `;
        } else {
            alert('خطأ: ' + data.error);
        }
    } catch (error) {
        alert('خطأ في الاتصال: ' + error.message);
    }
});

// Initialize Feather icons
if (typeof feather !== 'undefined') {
    feather.replace();
}
</script>
{% endblock %}