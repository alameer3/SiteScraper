{% extends "base.html" %}

{% block title %}تحليل SEO - {{ super() }}{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-lg border-0 mb-4">
                <div class="card-header bg-info text-white">
                    <h2 class="mb-0">
                        <i data-feather="search" class="me-2"></i>
                        تحليل تحسين محركات البحث (SEO)
                    </h2>
                </div>
                <div class="card-body p-4">
                    <form id="seoForm">
                        <div class="mb-4">
                            <label for="url" class="form-label fw-bold">رابط الموقع</label>
                            <input type="url" class="form-control form-control-lg" id="url" 
                                   placeholder="https://example.com" required>
                        </div>
                        
                        <div class="mb-4">
                            <label class="form-label fw-bold">عناصر التحليل</label>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="onpage" value="onpage" checked>
                                        <label class="form-check-label" for="onpage">
                                            تحسين الصفحة (On-Page)
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="technical" value="technical" checked>
                                        <label class="form-check-label" for="technical">
                                            التحسين التقني
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="content" value="content" checked>
                                        <label class="form-check-label" for="content">
                                            جودة المحتوى
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="meta" value="meta" checked>
                                        <label class="form-check-label" for="meta">
                                            الـ Meta Tags
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="social" value="social" checked>
                                        <label class="form-check-label" for="social">
                                            الشبكات الاجتماعية
                                        </label>
                                    </div>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="structured" value="structured" checked>
                                        <label class="form-check-label" for="structured">
                                            البيانات المنظمة
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-info btn-lg">
                            <i data-feather="search" class="me-2"></i>
                            بدء تحليل SEO
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Progress Section -->
            <div id="progress-section" class="card shadow-lg border-0 mb-4" style="display: none;">
                <div class="card-body">
                    <div class="text-center">
                        <div class="spinner-border text-info mb-3" role="status">
                            <span class="visually-hidden">جاري التحليل...</span>
                        </div>
                        <h5>جاري تحليل SEO للموقع...</h5>
                        <p class="text-muted">قد تستغرق هذه العملية بضع دقائق</p>
                    </div>
                </div>
            </div>
            
            <!-- Results Section -->
            <div id="results-section" style="display: none;"></div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    feather.replace();
    
    document.getElementById('seoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const url = document.getElementById('url').value;
        const checkboxes = document.querySelectorAll('input[type="checkbox"]:checked');
        const analysisTypes = Array.from(checkboxes).map(cb => cb.value);
        
        if (!url) {
            alert('يرجى إدخال رابط الموقع');
            return;
        }
        
        // Show progress
        document.getElementById('progress-section').style.display = 'block';
        document.getElementById('results-section').style.display = 'none';
        
        // Send analysis request
        fetch('/api/seo-analyze', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                url: url,
                analysis_types: analysisTypes
            })
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById('progress-section').style.display = 'none';
            displayResults(data);
        })
        .catch(error => {
            document.getElementById('progress-section').style.display = 'none';
            alert('حدث خطأ أثناء التحليل: ' + error.message);
        });
    });
    
    function displayResults(data) {
        const resultsSection = document.getElementById('results-section');
        resultsSection.innerHTML = `
            <div class="card shadow-lg border-0">
                <div class="card-header bg-info text-white">
                    <h3 class="mb-0">
                        <i data-feather="trending-up" class="me-2"></i>
                        نتائج تحليل SEO
                    </h3>
                </div>
                <div class="card-body">
                    <pre class="bg-light p-3 rounded">${JSON.stringify(data, null, 2)}</pre>
                </div>
            </div>
        `;
        resultsSection.style.display = 'block';
        feather.replace();
    }
});
</script>
{% endblock %}